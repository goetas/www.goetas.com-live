<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>

                <meta charset="utf-8">
        <title>How to use external services with the Symfony Validator - Asmir Mustafic</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" href="/favicon.png">

                <link rel="preload" href="/assets/webfonts/fa-brands-400.woff2" as="font">
        <link rel="preload" href="/assets/webfonts/fa-solid-900.woff2" as="font">

        <link rel="preload" href="/js/combined-89009af45ae96d51be4ea3b08dcbe284e02c8589.js" as="script">

        <link rel="stylesheet" href="/assets/css/combined-290b696597440bb7fbb06e00ec4beaadbd291e6b.css">
        
        <meta property="og:url" content="https://www.goetas.com/blog/how-to-use-external-services-with-the-symfony-validator" />

        <meta name="twitter:title" content="How to use external services with the Symfony Validator - Asmir Mustafic" />
        <meta name="og:title" content="How to use external services with the Symfony Validator - Asmir Mustafic" />
        <meta name="twitter:site" content="@goetas_asmir" />
        <meta name="twitter:creator" content="@goetas_asmir" />

            <meta name="twitter:card" content="summary_large_image" />
            <meta property="og:image" content="https://www.goetas.com/img/posts/expression-valid.jpg" />
        <meta property="twitter:image" content="https://www.goetas.com/img/posts/expression-valid.jpg" />
    
        <script type="application/ld+json">
        {
          "@context": "http://schema.org",
          "@type": "Person",
          "name": "Asmir Mustafic",
          "url": "https://www.goetas.com",
          "sameAs": [
            "https://github.com/goetas",
            "https://twitter.com/goetas_asmir",
            "https://linkedin.com/in/goetas",
            "https://www.facebook.com/goetas",
            "https://www.facebook.com/goetasDev"
          ]
        }
        </script>
    
            <script type="application/ld+json">
        {
         "@context": "http://schema.org",
         "@type": "BlogPosting",
         "headline": "How to use external services with the Symfony Validator",
         "image": "http://example.com/image.jpg",
         "datePublished": "2019-10-07",
         "dateModified": "2019-10-07",
         "description": "In&#x20;this&#x20;article&#x20;we&#x20;are&#x20;going&#x20;to&#x20;see&#x20;a&#x20;particular&#x20;case&#x20;of&#x20;validation&#x20;using&#x20;the&#x20;Symfony&#x20;Validator&#x20;expression&#x20;language&#x20;&#x20;and&#x20;accessing&#x20;third&#x20;party&#x20;services.",
         "author": {
            "@type": "Person",
              "name": "Asmir Mustafic",
              "url": "https://www.goetas.com",
              "sameAs": [
                "https://github.com/goetas",
                "https://twitter.com/goetas_asmir",
                "https://linkedin.com/in/goetas",
                "https://www.facebook.com/goetas",
                "https://www.facebook.com/goetasDev"
              ]
          },
          "publisher": {
            "@type": "Organization",
            "name": "Asmir Mustafic",
            "logo": "https://www.goetas.com/favicon.ico"
          },
          "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https://www.goetas.com/blog/how-to-use-external-services-with-the-symfony-validator"
          }
         }
        </script>
    
            <script type="application/ld+json">
        {
          "@context": "http://schema.org",
          "@type": "BreadcrumbList",
          "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
              "@id": "https://www.goetas.com/blog/",
              "name": "Blog"
            }
          },{
            "@type": "ListItem",
            "position": 2,
            "item": {
              "@id": "https://www.goetas.com/blog/how-to-use-external-services-with-the-symfony-validator",
              "name": "How to use external services with the Symfony Validator"
            }
          }]
        }
        </script>
        <link rel="stylesheet" href="/js/highlight/styles/qtcreator_light.css">

                <meta name="description" content="In this article we are going to see a particular case of validation using the Symfony Validator expression language  and accessing third party services. ">
        <meta name="twitter:description" content="In this article we are going to see a particular case of validation using the Symfony Validator expression language  and accessing third party services. ">
        <meta name="og:description" content="In this article we are going to see a particular case of validation using the Symfony Validator expression language  and accessing third party services. ">
        <meta property="og:type"  content="article" />
    
            <meta name="keywords" content="php, symfony, validator, validation, expression-language, ">
    
</head>

<body data-spy="scroll" data-target=".navbar-collapse">

<div class="culmn">
    <!--Home page style-->
    <nav class="navbar navbar-default bootsnav navbar-fixed">
        <div class="navbar-top bg-grey fix">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="navbar-callus text-left sm-text-center">
                            <ul class="list-inline">
                                <li>
                                    <a href="mailto:info@goetas.com"><i class="fas fa-envelope"></i> Contact: info@goetas.com</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 hidden-xs">
                        <div class="navbar-socail text-right sm-text-center">
                            <ul class="list-inline">
                                <li><a target="_blank" href="https://twitter.com/goetas_asmir"><i class="fab fa-twitter"></i></a></li>
                                <li><a target="_blank" href="https://linkedin.com/in/goetas"><i class="fab fa-linkedin"></i></a></li>
                                <li><a target="_blank" href="https://github.com/goetas"><i class="fab fa-github"></i></a></li>
                                <li><a target="_blank" href="https://keybase.io/goetas" title="keybase - Asmir Mustafic"><i class="fab fa-keybase"></i></a></li>
                                <li><a target="_blank" href="skype:goetas?call"><i class="fab fa-skype"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Start Header Navigation -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
                    <i class="fas fa-bars"></i>
                </button>
                <a class="navbar-brand" href="/">
                    Asmir Mustafic
                                            <span class="subtitle">Software Engineering, PHP and DevOps solutions</span>
                                    </a>
            </div>
            <!-- End Header Navigation -->

            <!-- navbar menu -->
            <div class="collapse navbar-collapse" id="navbar-menu">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/">Home</a></li>
                    <li><a href="/services/" >Services</a></li>
                    <li><a href="/projects/" >Portfolio</a></li>
                    <li><a href="/blog/"  class="active">Blog</a></li>
                    <li><a href="/talks/" >Talks</a></li>
                    <li><a href="/opensource/" >Open Source</a></li>

                    <li><a href="/contact/" >Contact</a></li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div>

    </nav>
    
    <article>
        
                <div class="breadcrumb">
           <a href="/blog//">Blog</a> &raquo;

            
            <i>How to use external services with the Symfony Validator</i>
        </div>
        
        <header>
            <h1>How to use external services with the Symfony Validator</h1>
        </header>

                <p class="subtitle">
                            In this article we are going to see a particular case of validation using the Symfony Validator expression language  and accessing third party services.

                    </p>

        
        
        
        
            
                        
                    
                <div class="col-md-5 hidden-xs related-posts">
                                
                                
                                                <div class="related-posts_container">
                        <h4>More posts from the author</h4>
                                        
                                                                                                    <div class="related-posts_item">
                            <a href="/blog/multi-namespace-migrations-with-doctrinemigrations-30">- Multi-namespace migrations with doctrine/migrations 3.0</a>
                        </div>
                                                                                                        <div class="related-posts_item">
                            <a href="/blog/released-doctrinemigrations-30-alpha">- Released doctrine/migrations 3.0-alpha</a>
                        </div>
                                                                                                        <div class="related-posts_item">
                            <a href="/blog/make-the-difference-when-contributing-to-open-source">- Make the difference when contributing to open-source</a>
                        </div>
                                                                                                                                            <div class="related-posts_item">
                            <a href="/blog/changing-credentials-on-docker-swarm-services">- Changing credentials on Docker Swarm Services</a>
                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                    </div>
                            
        </div>
        
                        


        <div class="m-top-20">
                                    
            
                <div class="m-top-20">
                    <time datetime="2019-10-7">
                        <i class="fa fa-calendar"></i>
                        2019-10-07                    </time>
                </div>

                        
                    </div>



        <div  class="m-top-20">
            

            <p>Validation is one of the most common tasks when building many types of software applications.</p>

<p>Talking more specifically about the <a href="https://symfony.com">Symfony Framework</a>, 
its <a href="https://symfony.com/doc/current/validation.html">Validator</a> component offers
a very powerful set of APIs to validate objects, arrays, forms and much more.</p>

<p>We are going to see a particular case of validation that requires third party services.
This question emerged during <a href="/talks/symfony-live-berlin-2019-great-apis-with-symfony-and-open-source-software">my talk</a> 
at <a href="https://berlin2019.live.symfony.com">Symfony Live</a> in Berlin last week.</p>

<h2 id="the-problem">The problem</h2>

<p>Let's consider the following class:</p>

<pre><code class="php">&lt;?php
use Symfony\Component\Validator\Constraints as Assert;

class User 
{
    /**
     * @var string
     * @Assert\Length(min="2", max="32")
     */
    public $nickname;
}
</code></pre>

<p>Using the <code>@Assert\Length</code> annotation we want to ensure that the nickname length is between 2 and 32 characters.
What about having a list of not allowed nicknames? That can be done using the <code>@Assert\Expression</code> assertion, 
that allows us to use the Symfony Expression Language in our validation rules.</p>

<pre><code class="php">&lt;?php
use Symfony\Component\Validator\Constraints as Assert;

class User 
{
    /**
     * @var string
     *
     * @Assert\Expression(
     *     "this.nickname not in ['admin', 'superuser']",
     *     message="This nickname is not allowed!"
     * )
     */
    public $nickname;
}
</code></pre>

<p>In this way we do not allow "admin" and "superuser" as nicknames.
 <strong>What if we want this list of not allowed nicknames to be provided by another "service" available in our application?</strong> 
With the default symfony validator setup this is not possible.</p>

<p>The expression language used by the validator component has a very limited set of features and can not refer 
to other parts of the application except of the object on which the validation is performed 
(through the <code>object</code> variable).</p>

<h2 id="the-solution">The solution</h2>

<p>Luckily it is pretty easy to re-configure the expression language provider and much more powerful.</p>

<p>We need to change the <code>validator.expression</code> expression language with a different instance having a wider
access to system services.</p>

<p>This can be done using a compiler pass and hooking into the Symfony Dependency Injection process.
We create  <code>src/DependencyInjection/CompilerPass/ValidatorExpressionLanguagePass.php</code> with the following content:</p>

<pre><code class="php">&lt;?php

namespace App\DependencyInjection\CompilerPass;

use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Reference;

class ValidatorExpressionLanguagePass implements CompilerPassInterface
{
    public function process(ContainerBuilder $container)
    {
        $container-&gt;getDefinition('validator.expression')-&gt;setArguments([
            null, 
            new Reference('security.expression_language')
        ]);
    }
}
</code></pre>

<p>We change the default validation expression language to <code>security.expression_language</code> 
(provided with the symfony security component), so we can use 
 the provided <code>service</code> and <code>parameter</code> functions to interact easily with the Symfony DI Container.</p>

<p>Next step is to register the <code>ValidatorExpressionLanguagePass</code> compiler pass in the <code>Kernel.php</code>.</p>

<pre><code class="php">&lt;?php

namespace App;

//..
use App\DependencyInjection\CompilerPass\ValidatorExpressionLanguagePass;

class Kernel extends BaseKernel
{
    //..
    protected function configureContainer(ContainerBuilder $container, LoaderInterface $loader)
    {
        // ...
        $container-&gt;addCompilerPass(new ValidatorExpressionLanguagePass());
        // ...
    }
}
</code></pre>

<p>With this change, now is possible to use other public services inside the expression language.</p>

<pre><code class="php">&lt;?php
use Symfony\Component\Validator\Constraints as Assert;

class User 
{
    /**
     * @var string
     *
     * @Assert\Expression(
     *     "this.nickname not in service('app.repo.forbidden_nicknames').getForbiddenNicknames()",
     *     message="This nickname is not allowed!"
     * )
     */
    public $nickname;
}
</code></pre>

<p><strong>Et voil√†!</strong></p>

<p>In this case the list of not allowed nicknames is provided by a hypothetical <code>app.repo.forbidden_nicknames</code> service, 
that can be any other service part of your application.</p>

<h3 id="p.s.">P.S.</h3>

<p>We can use any other expression language instance instead of <code>security.expression_language</code>.</p>

<p>To make an example, the <code>jms/serializer-bundle</code> provides the <code>jms_serializer.expression_language</code> 
that has built in functions such as <code>service</code>, <code>is_granted</code> and <code>parameter</code>. You can choose it 
if you want to use the <code>is_granted</code> function that is not provided by the security expression language instance.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Hope you enjoyed this article, if you have some feedback, do not contact me or to send me a tweet!</p>

        </div>



                <div class="business_btn roomy-40-positive">
            



        </div>
        
                            
                    <p class="tags m-top-50">
                <i class="fa fa-tags"></i>
                                <span>php</span>,                                 <span>symfony</span>,                                 <span>validator</span>,                                 <span>validation</span>,                                 <span>expression-language</span>                            </p>
        
                <div class="row visible-xs">
            <div class="col-xs-12 related-posts">
                                    
                                    
            </div>
        </div>
        
        
                <div class="share-on-socials">
            <div>Share or comment on:</div>

            <div  class="m-top-10 share-on-socials-buttons">
                <!-- Twitter (url, text, @mention) -->
                <a href="http://twitter.com/share?url=https%3A%2F%2Fwww.goetas.com%2Fblog%2Fhow-to-use-external-services-with-the-symfony-validator&text=I%27ve%20just%20read%20%22How%20to%20use%20external%20services%20with%20the%20Symfony%20Validator%22%20by%20%40goetas_asmir" target="_blank" class="share-btn twitter">
                    <i class="fab fa-twitter"></i> Twitter
                </a>

                <!-- Facebook (url) -->
                <a href="http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.goetas.com%2Fblog%2Fhow-to-use-external-services-with-the-symfony-validator" target="_blank" class="share-btn facebook">
                    <i class="fab fa-facebook"></i> Facebook
                </a>

                <!-- Reddit (url, title) -->
                <a href="http://reddit.com/submit?url=https%3A%2F%2Fwww.goetas.com%2Fblog%2Fhow-to-use-external-services-with-the-symfony-validator&title=How%20to%20use%20external%20services%20with%20the%20Symfony%20Validator%20-%20Asmir%20Mustafic" target="_blank" class="share-btn reddit">
                    <i class="fab fa-reddit"></i> Reddit
                </a>

                <!-- LinkedIn (url, title, summary, source url) -->
                <a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.goetas.com%2Fblog%2Fhow-to-use-external-services-with-the-symfony-validator&title=How%20to%20use%20external%20services%20with%20the%20Symfony%20Validator%20-%20Asmir%20Mustafic&summary=In%20this%20article%20we%20are%20going%20to%20see%20a%20particular%20case%20of%20validation%20using%20the%20Symfony%20Validator%20expression%20language%20%20and%20accessing%20third%20party%20services.%0A&source=https://www.goetas.com" target="_blank" class="share-btn linkedin">
                    <i class="fab fa-linkedin"></i> LinkedIn
                </a>
                <!-- Google Plus (url) -->
                <a href="https://plus.google.com/share?url=https%3A%2F%2Fwww.goetas.com%2Fblog%2Fhow-to-use-external-services-with-the-symfony-validator" target="_blank" class="share-btn google-plus">
                    <i class="fab fa-google-plus"></i> Google +
                </a>
            </div>
        </div>
        
                    <nav class="article  m-top-50 hidden-xs">
                <div class="row">

                                            <div class="col-md-5   article-pagination article-pagination-prev">
                            <div>
                                <a class="previous" href="/blog/changing-credentials-on-docker-swarm-services" title="Changing credentials on Docker Swarm Services">
                                    <span class="article-pagination-icon"><i class="fa fa-chevron-circle-left"></i> Previous </span>
                                    <span class="title">Changing credentials on Docker Swarm Services</span>
                                </a>
                            </div>
                        </div>
                                                            <div class="col-md-5 col-md-offset-2  article-pagination article-pagination-next">
                        <div>
                            <a class="next" href="/blog/make-the-difference-when-contributing-to-open-source" title="Make the difference when contributing to open-source">
                                <span class="article-pagination-icon"><i class="fa fa-chevron-circle-right"></i> Next</span>
                                <span class="title">Make the difference when contributing to open-source</span>
                            </a>
                        </div>
                    </div>
                                    </div>

            </nav>
        
    </article>

        <!--Call to  action section-->
    <section id="action" class="action bg-primary roomy-40">
        <div class="container">
            <div class="row">
                <div class="maine_action">
                    <div class="col-md-8">
                        <div class="action_item text-center">
                            <h4 class="text-white text-uppercase">
                                                                                                            Do you need something similar for your company?
                                                                                                </h4>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="action_btn text-left sm-text-center">
                            <a href="/contact/" class="btn btn-default">
                                                                    Contact me now!
                                </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <footer id="contact" class="footer action-lage bg-black p-top-80">
                <div class="container">
            <div class="row">
                <div class="widget_area">
                    <div class="col-md-3">
                        <div class="widget_item widget_about">
                            <h5 class="text-white">About</h5>
                            <p class="m-top-20">
                                Software Engineering, PHP and DevOps solutions.
                                <br>
                                Helping companies to solve architecture and infrastructure problems.
                            </p>

                            <div class="widget_ab_item m-top-30">
                                <div class="item_icon"><i class="fas fa-map-marked"></i></div>
                                <div class="widget_ab_item_text">
                                    <h6 class="text-white">Location</h6>
                                    <p>Berlin - Germany - World</p>
                                </div>
                            </div>
                            <div class="widget_ab_item m-top-30">
                                <div class="item_icon"><i class="fas fa-envelope"></i></div>
                                <div class="widget_ab_item_text">
                                    <h6 class="text-white">Email Address :</h6>
                                    <p><a href="mailto:info@goetas.com" style="color: #797979">info@goetas.com</a></p>
                                </div>
                            </div>
                        </div><!-- End off widget item -->
                    </div><!-- End off col-md-3 -->

                    <div class="col-md-3">
                        <div class="widget_item widget_service sm-m-top-50">
                            <h5 class="text-white">Latest Blog Posts
                                &nbsp;<a href="/atom.xml" target="_blank" title="Blog feed"><i class="fas fa-rss-square"></i></a>
                            </h5>
                            <ul class="m-top-20">
                                                                    <li class="m-top-20"><a href="/blog/multi-namespace-migrations-with-doctrinemigrations-30/"><i class="fas fa-angle-right"></i>Multi-namespace migrations with doctrine/migrations 3.0</a></li>
                                                                    <li class="m-top-20"><a href="/blog/released-doctrinemigrations-30-alpha/"><i class="fas fa-angle-right"></i>Released doctrine/migrations 3.0-alpha</a></li>
                                                                    <li class="m-top-20"><a href="/blog/make-the-difference-when-contributing-to-open-source/"><i class="fas fa-angle-right"></i>Make the difference when contributing to open-source</a></li>
                                                                    <li class="m-top-20"><a href="/blog/how-to-use-external-services-with-the-symfony-validator/"><i class="fas fa-angle-right"></i>How to use external services with the Symfony Validator</a></li>
                                                            </ul>
                        </div><!-- End off widget item -->
                    </div><!-- End off col-md-3 -->

                    <div class="col-md-3">
                        <div class="widget_item widget_newsletter sm-m-top-50">
                            <div class="widget_brand m-top-40">
                                <a href="/" class="widget_brand-main-link text-uppercase">Asmir Mustafic</a>
                                <p>
                                    Software Engineering, PHP and DevOps solutions
                                    <br>
                                    <a href="/credits/" style="color: #797979">Impressum</a>
                                </p>
                            </div>
                            <ul class="list-inline m-top-20">
                                <li><a target="_blank" href="https://twitter.com/goetas_asmir" title="Twitter - Asmir Mustafic"><i class="fab fa-twitter"></i></a></li>
                                <li><a target="_blank" href="https://linkedin.com/in/goetas" title="LinkedIn - Asmir Mustafic"><i class="fab fa-linkedin"></i></a></li>
                                <li><a target="_blank" href="https://github.com/goetas" title="Github - Asmir Mustafic"><i class="fab fa-github"></i></a></li>
                                <li><a target="_blank" href="https://keybase.io/goetas" title="keybase - Asmir Mustafic"><i class="fab fa-keybase"></i></a></li>
                                <li><a target="_blank" href="skype:goetas?call"><i class="fab fa-skype"></i></a></li>
                            </ul>

                        </div><!-- End off widget item -->
                    </div><!-- End off col-md-3 -->
                </div>
            </div>
        </div>
        <div class="main_footer fix bg-mega text-center p-top-40 p-bottom-30 m-top-80">
            <div class="col-md-12">
                <p class="wow fadeInRight" data-wow-duration="1s">
                    Asmir Mustafic. All Rights Reserved
                </p>
            </div>
        </div>
    </footer>

</div>

    
<script src="/js/combined-89009af45ae96d51be4ea3b08dcbe284e02c8589.js"></script>

    <script src="/js/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript">
    new LazyLoad({
        elements_selector: ".lazy"
    });
</script>

</body>
</html>
